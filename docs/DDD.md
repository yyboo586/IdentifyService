# 层次划分
## 接口层
- 参数解析。

## 应用服务层(xxAppService)
- <span style="color:red">**协调**</span> **领域层** 和 **基础设施层** 完成一次业务请求。
- 处理事务管理。
- 数据模型转换。

## 领域层
- **高内聚，只关注自己的核心职责**。
- 实现核心业务逻辑，提供领域服务接口。
- 如 org、user、role等。

## 基础设施层
- 如数据库、消息队列、外部服务调用等。

# 聚合根
- 在了解聚合根概念前，先来看一个问题：
- 创建用户时，这个HTTP请求应该由 userAppService 处理 还是 orgAppService 处理？
    - userAppService处理，对应的路由应该是
    ```http
    POST /users
    {
        "org_id": "xxx"
    }
    ```
    - orgAppService处理，对应的路由应该是
    ```http
    POST /orgs/{org_id}/users
    ```
    - 对于第一种路由，org_id 看起来是可以为空的。当然，您可以在参数校验时强制org_id不能为空。这也就意味着 <span style="color:red">**用户必须归属到组织**</span>。
- 所以，创建用户这个请求由谁处理，实际上取决于您的<span style="color:red">**业务模型**</span>：**用户必须归属组织/用户可以不归属组织**.

- 外部只能通过聚合根，访问其内部对象(创建、修改、删除)。

# 接口设计原则
- 领域对象需要对外提供接口，应当遵循以下原则:
    - 不提供修改内部状态的接口。

# 处理领域依赖
- 依赖注入
- 发布领域事件
- 应用服务协调

# 权限校验
- 基础权限校验: 令牌是否有效
- 业务权限校验: 是否有操作权限